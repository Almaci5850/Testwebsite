<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bruchrechnen Trainer - Differenziert</title>
    <style>
        /* Design: Blau (NRW/Europa) und Gelb */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #005293; /* Kr√§ftiges Blau */
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            background-color: #ffecb3; /* Sanftes Gelb */
            border: 4px solid #fdd835; /* Kr√§ftigeres Gelb */
            border-radius: 15px;
            padding: 30px;
            width: 100%;
            max-width: 650px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            text-align: center;
            position: relative;
        }

        h1 {
            color: #005293;
            margin-top: 0;
            margin-bottom: 10px;
        }

        /* Schwierigkeitsgrad Auswahl */
        .level-selector {
            margin-bottom: 25px;
            background-color: #fff8e1;
            padding: 10px;
            border-radius: 8px;
            display: inline-block;
            border: 1px solid #fdd835;
        }

        select {
            padding: 8px;
            font-size: 1rem;
            border: 2px solid #005293;
            border-radius: 5px;
            background-color: white;
            color: #005293;
            font-weight: bold;
            cursor: pointer;
        }

        /* Bruch-Darstellung */
        .fraction {
            display: inline-block;
            vertical-align: middle;
            margin: 0 5px;
            text-align: center;
            font-size: 1.8rem;
            font-weight: bold;
        }
        .top {
            display: block;
            border-bottom: 3px solid #000;
            padding: 2px 5px;
            line-height: 1.2;
        }
        .bottom {
            display: block;
            padding: 2px 5px;
            line-height: 1.2;
        }

        .operator {
            font-size: 2rem;
            vertical-align: middle;
            font-weight: bold;
            margin: 0 10px;
            color: #005293;
        }

        /* Eingabefelder */
        input[type="number"] {
            width: 60px;
            padding: 5px;
            font-size: 1.5rem;
            text-align: center;
            border: 3px solid #005293;
            border-radius: 8px;
            font-weight: bold;
            /* Entfernt die kleinen Pfeile in manchen Browsern */
            -moz-appearance: textfield; 
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Buttons */
        .btn-group {
            margin-top: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
        }

        button {
            padding: 12px 24px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        button:active {
            transform: translateY(2px);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .btn-check { background-color: #2e7d32; color: white; } /* Gr√ºn */
        .btn-new { background-color: #005293; color: white; } /* Blau */
        .btn-hint { background-color: #039be5; color: white; } /* Hellblau */
        .btn-solve { background-color: #d32f2f; color: white; } /* Rot */

        /* Feedback Bereiche */
        #message {
            margin-top: 25px;
            font-weight: bold;
            font-size: 1.2rem;
            min-height: 1.5em;
            padding: 10px;
            border-radius: 5px;
        }

        .bg-correct { background-color: #c8e6c9; color: #1b5e20; border: 1px solid #81c784; }
        .bg-wrong { background-color: #ffcdd2; color: #b71c1c; border: 1px solid #e57373; }

        #hint-box, #solution-box {
            display: none;
            margin-top: 25px;
            text-align: left;
            background-color: #fff;
            padding: 20px;
            border-radius: 12px;
            border-left: 6px solid #005293;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .step {
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 1.05rem;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 10px;
        }
        .step:last-child { border-bottom: none; }
        
        .step strong { color: #005293; }

    </style>
</head>
<body>

<div class="container">
    <h1>Bruchrechnen Trainer 6. Klasse</h1>
    
    <div class="level-selector">
        <label for="level-select">Schwierigkeitsgrad:</label>
        <select id="level-select" onchange="generateTask()">
            <option value="1">Stufe 1: Gleiche Nenner (Einstieg)</option>
            <option value="2">Stufe 2: Ein Nenner ist Vielfaches (Mittel)</option>
            <option value="3">Stufe 3: Ungleiche Nenner (Experte)</option>
        </select>
    </div>

    <p>L√∂se die Aufgabe und k√ºrze vollst√§ndig!</p>

    <div id="task-area">
        <span class="fraction"><span class="top" id="n1"></span><span class="bottom" id="d1"></span></span>
        <span class="operator" id="op"></span>
        <span class="fraction"><span class="top" id="n2"></span><span class="bottom" id="d2"></span></span>
        <span class="operator">=</span>
        <span class="fraction">
            <input type="number" id="input-n" placeholder="Z">
            <div style="border-top: 3px solid #000; margin: 4px 0;"></div>
            <input type="number" id="input-d" placeholder="N">
        </span>
    </div>

    <div id="message"></div>

    <div class="btn-group">
        <button class="btn-hint" onclick="showHint()">üí° Hinweis</button>
        <button class="btn-check" onclick="checkAnswer()">‚úÖ Pr√ºfen</button>
        <button class="btn-solve" onclick="showSolution()">üìù L√∂sungsweg</button>
        <button class="btn-new" onclick="generateTask()">üîÑ Neue Aufgabe</button>
    </div>

    <div id="hint-box">
        <span id="hint-text"></span>
    </div>

    <div id="solution-box">
        </div>
</div>

<script>
    // Globale Variablen
    let num1, den1, num2, den2, operator;
    let expectedNum, expectedDen; 
    
    // Mathematische Hilfsfunktionen
    const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
    const lcm = (a, b) => (a * b) / gcd(a, b);
    const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

    function generateTask() {
        // UI Reset
        document.getElementById('input-n').value = '';
        document.getElementById('input-d').value = '';
        const msg = document.getElementById('message');
        msg.innerText = '';
        msg.className = '';
        document.getElementById('hint-box').style.display = 'none';
        document.getElementById('solution-box').style.display = 'none';

        // Level und Operator holen
        const level = parseInt(document.getElementById('level-select').value);
        const isPlus = Math.random() > 0.5;
        operator = isPlus ? '+' : '-';

        // Nenner generieren basierend auf Level
        if (level === 1) {
            // Stufe 1: Gleiche Nenner
            den1 = getRandomInt(3, 12);
            den2 = den1;
        } 
        else if (level === 2) {
            // Stufe 2: Ein Nenner ist Vielfaches des anderen
            // Wir nehmen eine Basis (2-6) und multiplizieren sie (x2, x3, x4)
            const base = getRandomInt(2, 6);
            const multiplier = getRandomInt(2, 4);
            
            // Zuf√§llig entscheiden, welcher Nenner der gr√∂√üere ist
            if (Math.random() > 0.5) {
                den1 = base;
                den2 = base * multiplier;
            } else {
                den1 = base * multiplier;
                den2 = base;
            }
        } 
        else {
            // Stufe 3: Ungleiche Nenner (meist teilerfremd oder komplexer)
            const list = [2, 3, 4, 5, 6, 7, 8, 9, 10, 12];
            do {
                den1 = list[getRandomInt(0, list.length - 1)];
                den2 = list[getRandomInt(0, list.length - 1)];
            } while (den1 === den2 || den1 % den2 === 0 || den2 % den1 === 0);
            // Die while-Schleife verhindert Level 1 und 2 F√§lle in Level 3
        }

        // Z√§hler generieren (Keine gemischten Zahlen -> Z√§hler < Nenner)
        num1 = getRandomInt(1, den1 - 1);
        num2 = getRandomInt(1, den2 - 1);

        // Bei Subtraktion sicherstellen: Ergebnis >= 0
        if (!isPlus) {
            const val1 = num1 / den1;
            const val2 = num2 / den2;
            
            // Wenn der zweite Bruch gr√∂√üer ist, tauschen wir die Br√ºche komplett
            if (val2 > val1) {
                [num1, num2] = [num2, num1];
                [den1, den2] = [den2, den1];
            }
            // Verhindern, dass Ergebnis 0 ist (z.B. 1/2 - 1/2), das ist langweilig
            if (num1 === num2 && den1 === den2) {
                // Wir erh√∂hen einfach den ersten Z√§hler oder verringern den zweiten
                if (num1 < den1 - 1) num1++;
                else if (num2 > 1) num2--;
            }
        }

        // Anzeige updaten
        document.getElementById('n1').innerText = num1;
        document.getElementById('d1').innerText = den1;
        document.getElementById('n2').innerText = num2;
        document.getElementById('d2').innerText = den2;
        document.getElementById('op').innerText = operator;

        // Ergebnis berechnen f√ºr die Pr√ºfung
        calculateExpectedResult();
    }

    function calculateExpectedResult() {
        const commonDen = lcm(den1, den2);
        const f1 = commonDen / den1;
        const f2 = commonDen / den2;
        const eN1 = num1 * f1;
        const eN2 = num2 * f2;

        let resRaw = (operator === '+') ? (eN1 + eN2) : (eN1 - eN2);
        const div = gcd(resRaw, commonDen);
        
        expectedNum = resRaw / div;
        expectedDen = commonDen / div;
    }

    function showHint() {
        const box = document.getElementById('hint-box');
        const text = document.getElementById('hint-text');
        const level = parseInt(document.getElementById('level-select').value);
        const commonDen = lcm(den1, den2);

        let msg = "";
        
        if (level === 1) {
            msg = "Die Nenner sind gleich! Du musst sie nicht ver√§ndern. Rechne einfach " + num1 + " " + operator + " " + num2 + ".";
        } else if (level === 2) {
            // Finde heraus, welcher der gr√∂√üere Nenner ist
            const maxD = Math.max(den1, den2);
            msg = `Ein Nenner passt in den anderen! Der Hauptnenner ist der gr√∂√üere von beiden: <strong>${maxD}</strong>. Erweitere den anderen Bruch.`;
        } else {
            msg = `Die Nenner sind verschieden. Suche das kleinste gemeinsame Vielfache (kgV) von ${den1} und ${den2}.<br>Der Hauptnenner ist <strong>${commonDen}</strong>.`;
        }
        
        text.innerHTML = "<strong>Tipp:</strong> " + msg;
        box.style.display = 'block';
    }

    function checkAnswer() {
        const userN = parseInt(document.getElementById('input-n').value);
        const userD = parseInt(document.getElementById('input-d').value);
        const msg = document.getElementById('message');

        if (isNaN(userN) || isNaN(userD)) {
            msg.innerText = "Bitte f√ºlle Z√§hler und Nenner aus!";
            msg.className = "bg-wrong";
            return;
        }

        if (userN === expectedNum && userD === expectedDen) {
            msg.innerText = "Super! Richtig gerechnet und gek√ºrzt! üéâ";
            msg.className = "bg-correct";
        } else {
            const userVal = userN / userD;
            const expectedVal = expectedNum / expectedDen;
            
            if (Math.abs(userVal - expectedVal) < 0.0000001) {
                msg.innerText = "Richtig gerechnet, aber noch nicht (vollst√§ndig) gek√ºrzt!";
                msg.className = "bg-wrong";
            } else {
                msg.innerText = "Das stimmt leider nicht. Versuch es nochmal!";
                msg.className = "bg-wrong";
            }
        }
    }

    function showSolution() {
        const box = document.getElementById('solution-box');
        const commonDen = lcm(den1, den2);
        const f1 = commonDen / den1;
        const f2 = commonDen / den2;
        const eN1 = num1 * f1;
        const eN2 = num2 * f2;
        const resRaw = (operator === '+') ? (eN1 + eN2) : (eN1 - eN2);
        const opText = operator === '+' ? "addiert" : "subtrahiert";
        const mkFrac = (n, d) => `<span class="fraction" style="font-size:1.2rem"><span class="top" style="border-width:2px">${n}</span><span class="bottom">${d}</span></span>`;

        let html = "";

        // Schritt 1
        if (den1 === den2) {
            html += `<div class="step"><strong>1. Nenner pr√ºfen:</strong><br>Die Nenner sind bereits gleich (${den1}). Wir k√∂nnen sofort rechnen.</div>`;
        } else {
            html += `<div class="step"><strong>1. Hauptnenner finden:</strong><br>Wir suchen das kgV von ${den1} und ${den2}.<br>Hauptnenner = <strong>${commonDen}</strong>.</div>`;
            
            html += `<div class="step"><strong>2. Erweitern:</strong><br>`;
            if (den1 !== commonDen) html += `1. Bruch (${mkFrac(num1,den1)}) mit ${f1} erweitern &#8594; ${mkFrac(eN1, commonDen)}<br>`;
            else html += `1. Bruch bleibt gleich.<br>`;
            
            if (den2 !== commonDen) html += `2. Bruch (${mkFrac(num2,den2)}) mit ${f2} erweitern &#8594; ${mkFrac(eN2, commonDen)}`;
            else html += `2. Bruch bleibt gleich.`;
            html += `</div>`;
        }

        // Schritt Rechnen
        html += `<div class="step"><strong>${den1===den2 ? '2' : '3'}. Rechnen:</strong><br>`;
        html += `Z√§hler werden ${opText}: ${eN1} ${operator} ${eN2} = ${resRaw}<br>`;
        html += `Ergebnis: ${mkFrac(resRaw, commonDen)}</div>`;

        // Schritt K√ºrzen
        const div = gcd(resRaw, commonDen);
        if (div > 1) {
            html += `<div class="step"><strong>${den1===den2 ? '3' : '4'}. K√ºrzen:</strong><br>`;
            html += `Teile Z√§hler und Nenner durch ${div}.<br>`;
            html += `Endresultat: <strong>${mkFrac(expectedNum, expectedDen)}</strong></div>`;
        } else {
             html += `<div class="step"><strong>${den1===den2 ? '3' : '4'}. K√ºrzen:</strong><br>`;
             html += `Man kann nicht weiter k√ºrzen.<br>Endresultat: <strong>${mkFrac(expectedNum, expectedDen)}</strong></div>`;
        }

        box.innerHTML = html;
        box.style.display = 'block';
    }

    // Start
    window.onload = generateTask;
</script>

</body>
</html>